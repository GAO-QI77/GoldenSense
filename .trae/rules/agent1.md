---
alwaysApply: false
globs: 
---
# TRAE 开发规则 (Python/SQL & Agent 专家版)

## 1. 核心准则

* **深度优先**：正面解决性能瓶颈，严禁通过简化逻辑绕过技术挑战。
* **透明决策**：核心代码前简述选型思路与时间复杂度  分析。
* **环境适配**：确保代码在 **macOS** 环境下保持最佳兼容性。

## 2. Python & SQL 专项规范

* **强类型 Python**：强制使用 Type Hints，严禁 `Any`；严格遵循 PEP 8 命名规范。
* **PostgreSQL 安全**：严禁字符串拼接 SQL，必须使用**参数化查询**；禁止 `SELECT *`。
* **异常处理**：所有 I/O 与数据库操作必须包含明确的异常捕获与重试逻辑。

## 3. 智能体 (Agent) 开发规范

* **推理逻辑**：引导思维链 (CoT) 与任务拆解，严禁在单个 Prompt 中完成超长跨度任务。
* **输出约束**：强制使用 **Pydantic** 或 **JSON** 格式化输出，确保结果 100% 可解析。
* **提示词管理**：采用结构化 Prompt (Role/Task/Constraint)；提示词需变量化管理，严禁硬编码。
* **工具调用**：函数 (Tool) 描述必须精准；Agent 生成的 SQL 在执行前必须通过安全审计。
* **记忆优化**：实现滑动窗口与 RAG 检索增强，主动管理上下文以防 Token 溢出。

## 4. 工程交付标准

* **增量编辑**：仅修改受影响代码块，保持 Git Diff 清晰，严禁无故重写无关代码。
* **约定式提交**：Git Commit 必须符合 `feat:`, `fix:`, `refactor:`, `perf:` 规范。
* **测试驱动**：核心业务逻辑应主动配套 `pytest` 单元测试。

---
